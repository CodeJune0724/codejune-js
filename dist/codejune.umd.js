(function(c,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(c=typeof globalThis<"u"?globalThis:c||self,g(c.codejune={}))})(this,function(c){"use strict";var g="";class w extends Error{constructor(e){super(e)}}class C{constructor(e){this.url=e.url,this.type=e.type,this.header=e.header,this.param=e.param,this.body=e.body,this.config=e.config}}var h=(t=>(t.POST="POST",t.GET="GET",t.PUT="PUT",t.DELETE="DELETE",t))(h||{}),u={isNull(t){return t==null},isEmpty(t){if(this.isNull(t))return!0;let e=this.getType(t);return e===String&&t===""||e===Array&&t.length===0?!0:e===Object&&Object.keys(t).length===0},getType(t){return this.isNull(t)?null:t.constructor},isObject(t){if(this.isNull(t))return!1;if(t instanceof Object){let e=this.getType(t);return e==null?!1:JSON.stringify(t)!==void 0||e.toString().indexOf("class")===0||e===Array?!0:e===Object}return!1},clone(t){if(this.isObject(t))if(this.getType(t)===Array){let e=[];for(let i of t)e.push(this.clone(i));return e}else{let e={};for(let i in t)e[i]=this.clone(t[i]);return e}else return this.isNull(t)?null:t},assignment(t,e,i){let r=this.getType(t),s=this.isEmpty(i)?!0:i===!0;if(!(!this.isObject(t)||!this.isObject(e)))if(r===Array){let l=!0;if(s&&this.getType(e)!==Array&&(l=!1),r!==this.getType(e)&&(l=!1),l){t.splice(0,t.length);for(let o of e)t.push(o)}}else if(s)for(let l in t){let o=t[l],n=e[l];if(o===void 0||n===void 0)continue;let a=!1;(o===null||n===null&&!this.isObject(o)||this.getType(o)===this.getType(n))&&(a=!0),a&&(this.isObject(n)&&(n=this.clone(n)),this.isObject(o)&&this.isObject(n)?this.assignment(o,n,!0):t[l]=n)}else for(let l in e){let o=e[l];o!==void 0&&(this.isObject(o)&&(o=this.clone(o)),t[l]=o)}},toStr(t){return this.isNull(t)?null:this.isObject(t)?JSON.stringify(t):t.toString()},clean(t){let e=this.getType(t);if(e===Array)t.splice(0);else if(e===Object)for(let i in t){let r=t[i];this.isObject(r)?this.clean(r):t[i]=null}},addKey(t,e){if(!(!this.isObject(t)||!this.isObject(e)))for(let i in e){let r=e[i];this.isNull(t[i])&&(this.isObject(r)?this.getType(r)===Array?t[i]=[]:t[i]={}:t[i]=null),this.addKey(t[i],r)}},filterKey(t,e){for(let i in t)e.indexOf(i)===-1&&delete t[i]}};class O{constructor(e){e&&(u.filterKey(e,["page","size","filter","sort"]),u.assignment(this,e,!1))}}class y{constructor(e){this.flag=!1,this.result=null,u.assignment(this,e)}}class T{constructor(){this.count=0,this.data=[]}}class b{constructor(){this.id=null}}var m={send(t){return new Promise((e,i)=>{this._getFetch(t).then(r=>{let s=r.text();r.ok?e(s):i(s)}).catch(r=>{i(r)})})},download(t){return new Promise((e,i)=>{try{window.open(this._getUrl(t)),e()}catch(r){i(r)}})},asyncDownload(t){return new Promise((e,i)=>{this._getFetch(t).then(r=>{let s=r.headers.get("Content-Type");s&&s.indexOf("download")!==-1?r.blob().then(l=>{try{let o=document.createElement("a"),n=window.URL.createObjectURL(l),a=r.headers.get("Content-Disposition");a=a||"";let p=/filename=(.*?)$/g.exec(a);p!==null&&(a=p[1]),o.href=n,o.download=decodeURI(a),o.click(),window.URL.revokeObjectURL(n),e()}catch(o){i(o)}}):r.text().then(l=>{i(l)})})})},_getUrl(t){let e=t.url,i=t.param?t.param:{};if(!u.isEmpty(i)){let r="?";for(let s in i){let l=i[s];u.isEmpty(l)||(r=r+s+"="+l+"&")}r!=="?"?r=r.substring(0,r.length-1):r="",e=e+r}return e},_getFetch(t){let e=this._getUrl(t),i=t.type,r=t.header?t.header:{},s=t.body,l=t.config,o=!1;if(u.isObject(s)){for(let n in s){let a=u.getType(s[n]);if(a===File||a===FileList){o=!0;break}if(a===Array){for(let f of s[n])if(u.getType(f)===File||u.getType(f)===FileList){o=!0;break}}}if(o){let n=new FormData;for(let a in s){let f=s[a];if(u.getType(f)===FileList)for(let p of f)n.append(a,p);else if(u.getType(f)===Array)for(let p of f)n.append(a,p);else n.append(a,f)}s=n}}if(u.isObject(s)&&u.getType(s)!==FormData){let n="BODY";switch(l&&l.dataType&&(n=l.dataType),n){case"BODY":s=JSON.stringify(s);break;case"FORM_DATA":let a=new FormData;for(let f in s)a.append(f,s[f]);s=a;break}}return i!==h.GET&&!o&&(r["content-type"]="application/json"),fetch(e,{cache:"no-cache",credentials:"same-origin",mode:"cors",redirect:"follow",referrer:"no-referrer",method:i,headers:r,body:i!==h.GET?s:void 0})}};class v{constructor(e){this.data={},this.url=e}$send(e,i){return new Promise((r,s)=>{let l=this._getName(e);m.send(this._getHttpRequest(e,i)).then(o=>{u.clean(this.data[l].response);let n;try{n=JSON.parse(o)}catch{n=o}u.isObject(this.data[l].response)?u.assignment(this.data[l].response,n,!1):this.data[l].response=n,r(this.data[l].response)}).catch(o=>{s(o)})})}$download(e,i){return new Promise((r,s)=>{let l=this._getHttpRequest(e,i);l.param=l.body,m.download(l).then(()=>{r()}).catch(o=>{s(o)})})}$asyncDownload(e,i){return new Promise((r,s)=>{let l=this._getHttpRequest(e,i);m.asyncDownload(l).then(()=>{r()}).catch(o=>{let n;try{n=JSON.parse(o)}catch{n=o}s(n)})})}$requestHandler(e){}_getHttpRequest(e,i){let r=this._getName(e),s=e.url,l=e.type,o=e.header,n=e.body,a=e.param;if(u.isEmpty(r))throw new w("\u65B9\u6CD5\u540D is null");if(u.isEmpty(l))throw new w("type is null");u.isEmpty(this.data[r])&&(this.data[r]={request:null,response:null}),n!=null&&(this.data[r].request=n),(u.isEmpty(i)||i===void 0)&&(i=()=>{});let f={url:this.url+"/"+s,type:l,header:o,body:this.data[r].request,param:a};return i(f),this.$requestHandler(f),f}_getName(e){let i=e.url,r=e.config;return r&&r.name&&(i=r.name),i}}class S extends v{constructor(e){super(e),this.data={}}$send(e,i){return new Promise((r,s)=>{super.$send(e,i).then(l=>{l.flag?r(l):s(l)}).catch(l=>{s(l)})})}}class A extends S{constructor(e,i,r){super(e),this.data={query:{request:new O({filter:r}),response:new y({result:new T})},save:{request:u.clone(i),response:new y},saveList:{request:[],response:new y},delete:{request:u.clone(i),response:new y},deleteList:{request:[],response:new y}}}query(e){return this.$send({url:"query",type:h.POST,body:e})}save(e){return this.$send({url:"save",type:h.POST,body:e})}saveList(e){return this.$send({url:"saveList",type:h.POST,body:e})}doDelete(e){return this.$send({url:"delete",type:h.POST,body:e})}deleteList(e){return this.$send({url:"deleteList",type:h.POST,body:e})}}let d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=function(t){let e="";t=t.replace(/\r\n/g,`
`);for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e+=String.fromCharCode(r):r>127&&r<2048?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(r&63|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(r&63|128))}return e},k=function(t){let e="",i=0,r,s,l=0;for(;i<t.length;)r=t.charCodeAt(i),r<128?(e+=String.fromCharCode(r),i++):r>191&&r<224?(s=t.charCodeAt(i+1),e+=String.fromCharCode((r&31)<<6|s&63),i+=2):(s=t.charCodeAt(i+1),l=t.charCodeAt(i+2),e+=String.fromCharCode((r&15)<<12|(s&63)<<6|l&63),i+=3);return e};var D={encode(t){let e="",i,r,s,l,o,n,a,f=0;for(t=E(t);f<t.length;)i=t.charCodeAt(f++),r=t.charCodeAt(f++),s=t.charCodeAt(f++),l=i>>2,o=(i&3)<<4|r>>4,n=(r&15)<<2|s>>6,a=s&63,isNaN(r)?n=a=64:isNaN(s)&&(a=64),e=e+d.charAt(l)+d.charAt(o)+d.charAt(n)+d.charAt(a);return e},decode(t){let e="",i,r,s,l,o,n,a,f=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<t.length;)l=d.indexOf(t.charAt(f++)),o=d.indexOf(t.charAt(f++)),n=d.indexOf(t.charAt(f++)),a=d.indexOf(t.charAt(f++)),i=l<<2|o>>4,r=(o&15)<<4|n>>2,s=(n&3)<<6|a,e=e+String.fromCharCode(i),n!==64&&(e=e+String.fromCharCode(r)),a!==64&&(e=e+String.fromCharCode(s));return e=k(e),e}},P={select(){return new Promise(t=>{let e=document.createElement("input");e.type="file",e.addEventListener("change",function(){let i=e.files;i===null?t():t(i[0])}),e.click()})},selectMore(){return new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.addEventListener("change",function(){let i=e.files;t(i)}),e.click()})}},N={create(t){let e={loading:!1,display:!1,...t,async open(i){this.display=!0,this.loading=!0,t.openHandler&&await t.openHandler(i),this.loading=!1},close(){this.display=!1}};return t.close&&(e.close=t.close),e}},_={getScreenHeight(){return window.screen.height}};c.BasePO=b,c.BaseService=S,c.DatabaseService=A,c.HttpRequest=C,c.InfoException=w,c.Query=O,c.QueryResult=T,c.ResponseResult=y,c.Service=v,c.base64=D,c.file=P,c.http=m,c.httpType=h,c.popupUtil=N,c.variable=u,c.windowUtil=_,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
